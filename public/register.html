<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>UNIQ ID — Register (Enter Email)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; padding: 20px; max-width: 720px; margin: auto; color:#111; }
    h1 { font-size: 20px; margin-bottom: 12px; }
    input[type="email"] { padding: 8px 10px; width: 100%; box-sizing: border-box; margin-bottom: 8px; font-size:16px; }
    button { padding: 8px 12px; font-size:15px; cursor:pointer; }
    pre { background:#f6f8fa; padding:12px; border-radius:6px; white-space:pre-wrap; word-break:break-word; }
    .ok { color: #155724; background:#d4edda; padding:8px; border-radius:6px; }
    .err { color: #721c24; background:#f8d7da; padding:8px; border-radius:6px; }
    .small { font-size:13px; color:#555; margin-top:8px; }
  </style>
</head>
<body>
  <h1>1) Register — Enter Email</h1>

  <form id="f1">
    <label for="email">Email</label><br />
    <input id="email" name="email" type="email" required placeholder="you@example.com" autocomplete="email" />
    <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px;">
      <button id="sendBtn">Send Verification</button>
      <span id="spinner" style="display:none;">⏳ sending…</span>
    </div>
  </form>

  <div id="result"></div>
  <pre id="o1" style="display:none"></pre>

  <p class="small">After clicking <em>Send Verification</em> you'll get a verification email. Click the link in that email to continue (it opens the verify page).</p>

  <script>
    (function(){
      const f1 = document.getElementById('f1');
      const emailInput = document.getElementById('email');
      const o1 = document.getElementById('o1');
      const result = document.getElementById('result');
      const sendBtn = document.getElementById('sendBtn');
      const spinner = document.getElementById('spinner');

      function showJSON(obj){
        o1.style.display = 'block';
        o1.textContent = JSON.stringify(obj, null, 2);
      }
      function setBusy(b){
        sendBtn.disabled = b;
        spinner.style.display = b ? 'inline' : 'none';
      }

      f1.addEventListener('submit', async (e) => {
        e.preventDefault();
        result.innerHTML = '';
        o1.style.display = 'none';
        const email = (emailInput.value || '').trim();
        if (!email) {
          result.innerHTML = '<div class="err">Please enter a valid email.</div>';
          return;
        }

        setBusy(true);
        try {
          const res = await fetch('/api/register-email', {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({ email })
          });
          const j = await res.json();
          if (j && j.success) {
            result.innerHTML = `<div class="ok">Verification email sent to <strong>${email}</strong>. Check your inbox (and spam).</div>`;
            showJSON(j);
          } else {
            result.innerHTML = `<div class="err">Failed: ${j && j.error ? (j.error) : 'Unknown error'}</div>`;
            if (j) showJSON(j);
          }
        } catch (err) {
          result.innerHTML = `<div class="err">Network error: ${err && err.message ? err.message : String(err)}</div>`;
        } finally {
          setBusy(false);
        }
      });
    })();
  </script>
</body>
</html>
